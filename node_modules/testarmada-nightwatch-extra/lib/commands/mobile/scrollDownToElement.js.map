{"version":3,"sources":["../../../src/commands/mobile/scrollDownToElement.js"],"names":["MAX_ATTEMPTS","distance","ScrollDownToElement","nightwatch","call","cmd","inherits","prototype","command","xStart","yStart","elementLocateStrategy","elementSelector","cb","self","selector","using","scrollToFindElement","attempts","client","api","getMobileElConditional","result","yEnd","xEnd","toLower","capabilities","platformName","Math","abs","failWithMessage","swipeScreenTo","passWithMessage","passMessage","pactual","pexpected","assertion","format","apply","emit","failMessage","module","exports"],"mappings":"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","file":"scrollDownToElement.js","sourcesContent":["import util from \"util\";\nimport BaseCommand from \"../../base-mobile-command\";\nimport _ from \"lodash\";\n\nconst MAX_ATTEMPTS = 10;\nconst distance = 200;\n\nconst ScrollDownToElement = function (nightwatch = null) {\n  BaseCommand.call(this, nightwatch);\n  this.cmd = \"scrolldowntoelement\";\n};\n\nutil.inherits(ScrollDownToElement, BaseCommand);\n\nScrollDownToElement.prototype.command = function (xStart, yStart, elementLocateStrategy, elementSelector, cb) {\n  const self = this;\n  this.selector = elementSelector;\n  this.using = elementLocateStrategy;\n  this.cb = cb;\n\n  const scrollToFindElement = function (attempts) {\n    if (attempts < MAX_ATTEMPTS) {\n      self.client.api.getMobileElConditional(\n        elementLocateStrategy,\n        elementSelector,\n        1000, (result) => {\n          if (!result) {\n            let yEnd = yStart > distance ? yStart - distance : 1;\n            let xEnd = xStart;\n            if (_.toLower(self.client.api.capabilities.platformName) === 'android') {\n\n            }\n            else if (_.toLower(self.client.api.capabilities.platformName) === 'ios') {\n              yEnd = -Math.abs(distance);\n              xEnd = 0;\n            }\n            else {\n              self.failWithMessage(`Invalid platform ${self.client.api.capabilities.platformName}`\n                + `, expected ios or android`)\n            }\n\n            self.client.api.swipeScreenTo(xStart, yStart, xEnd, yEnd, () => {\n              scrollToFindElement(attempts + 1);\n            });\n          } else {\n            self.passWithMessage(`Selector '${self.using}:${self.selector}' `\n              + `was visible after scrolling`);\n          }\n        });\n\n    } else {\n      self.failWithMessage(`Selector '${self.using}:${self.selector}' `\n        + `was not visible after scrolling ${MAX_ATTEMPTS} times`);\n    }\n  };\n\n  scrollToFindElement(0)\n};\n\nScrollDownToElement.prototype.passWithMessage = function (passMessage) {\n  const pactual = \"visible\";\n  const pexpected = pactual;\n\n  this.client.assertion(true, pactual, pexpected, util.format(passMessage), true);\n\n  if (this.cb) {\n    this.cb.apply(this.client.api, []);\n  }\n  this.emit(\"complete\");\n};\n\nScrollDownToElement.prototype.failWithMessage = function (failMessage) {\n  const pactual = \"not visible\";\n  const pexpected = \"visible\";\n\n  this.client.assertion(false, pactual, pexpected, util.format(failMessage), true);\n\n  if (this.cb) {\n    this.cb.apply(this.client.api, []);\n  }\n  this.emit(\"complete\");\n};\n\nmodule.exports = ScrollDownToElement;\n"]}