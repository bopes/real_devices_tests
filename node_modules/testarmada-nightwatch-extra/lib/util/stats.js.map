{"version":3,"sources":["../../src/util/stats.js"],"names":["event","sdclient","customizedOptions","isEnabled","ISENABLED","host","HOST","port","PORT","prefix","PREFIX","jobName","JOBNAME","fullEventKey","format","capabilities","id","browserName","type","cmd","client","timing","value","totalTime","seleniumCallTime","executeAsyncTime","process","env","MAGELLAN_STATSD","MAGELLANSTATS_STATSD_URL","MAGELLANSTATS_STATSD_PORT","MAGELLANSTATS_STATSD_PREFIX","MAGELLAN_JOB_NAME"],"mappings":";;;;;;kBAWe,UAAUA,KAAV,EAA4D;AAAA,MAA3CC,QAA2C,uEAAhC,IAAgC;AAAA,MAA1BC,iBAA0B,uEAAN,IAAM;;AACzE;;;;;;;;;;;;;;;;;;;;AAoBA,MAAMC,YAAYD,oBAAoBA,kBAAkBC,SAAtC,GAAkDC,SAApE;AACA,MAAMC,OAAOH,oBAAoBA,kBAAkBG,IAAtC,GAA6CC,IAA1D;AACA,MAAMC,OAAOL,oBAAoBA,kBAAkBK,IAAtC,GAA6CC,IAA1D;AACA,MAAMC,SAASP,oBAAoBA,kBAAkBO,MAAtC,GAA+CC,MAA9D;AACA,MAAMC,UAAUT,oBAAoBA,kBAAkBS,OAAtC,GAAgDC,OAAhE;;AAEA,MAAI,CAACT,SAAD,IAAc,CAACE,IAAf,IAAuB,CAACE,IAA5B,EAAkC;AAChC;AACD;;AAED,MAAMM,eAAe,eAAKC,MAAL,CACnB,kBADmB,EAEnBL,MAFmB,EAGnBT,MAAMe,YAAN,CAAmBC,EAAnB,IAAyBhB,MAAMe,YAAN,CAAmBE,WAHzB,EAInBjB,MAAMe,YAAN,CAAmB,mBAAnB,IAA0C,QAA1C,GAAqD,UAJlC,EAKnBJ,OALmB,EAMnBX,MAAMkB,IANa,EAOnBlB,MAAMmB,GAPa,CAArB;;AAUA,MAAMC,SAASnB,WAAWA,QAAX,GAAsB,2BAAQ,EAAEI,UAAF,EAAQE,UAAR,EAAcE,cAAd,EAAR,CAArC;;AAEAW,SAAOC,MAAP,CAAiBR,YAAjB,iBAA4Cb,MAAMsB,KAAN,CAAYC,SAAxD;AACAH,SAAOC,MAAP,CAAiBR,YAAjB,wBAAmDb,MAAMsB,KAAN,CAAYE,gBAA/D;AACAJ,SAAOC,MAAP,CAAiBR,YAAjB,wBAAmDb,MAAMsB,KAAN,CAAYG,gBAA/D;AACD,C;;AAzDD;;;;AACA;;;;;;AAEA;AACA,IAAMrB,YAAYsB,QAAQC,GAAR,CAAYC,eAAZ,GAA8B,IAA9B,GAAqC,KAAvD;AACA,IAAMtB,OAAOoB,QAAQC,GAAR,CAAYE,wBAAzB;AACA,IAAMrB,OAAOkB,QAAQC,GAAR,CAAYG,yBAAzB;AACA,IAAMpB,SAAYgB,QAAQC,GAAR,CAAYI,2BAAxB,MAAN;AACA,IAAMnB,UAAUc,QAAQC,GAAR,CAAYK,iBAA5B;;AAEA","file":"stats.js","sourcesContent":["import util from \"util\";\nimport SDC from \"statsd-client\";\n\n// second check for magellan compatibility\nconst ISENABLED = process.env.MAGELLAN_STATSD ? true : false;\nconst HOST = process.env.MAGELLANSTATS_STATSD_URL;\nconst PORT = process.env.MAGELLANSTATS_STATSD_PORT;\nconst PREFIX = `${process.env.MAGELLANSTATS_STATSD_PREFIX }.`;\nconst JOBNAME = process.env.MAGELLAN_JOB_NAME;\n\n/*eslint complexity: [\"error\", 12]*/\nexport default function (event, sdclient = null, customizedOptions = null) {\n  /**\n   *  event: {\n            \"capabilities\": {\n                id: 'chrome_latest_Windows_10_Desktop',\n                browserName: 'chrome',\n                version: '50',\n                platform: 'Windows 10',\n                'tunnel-identifier': 'some-tunnel-value',\n                name: 'Google'\n            }\n            \"type\"\" \"command\"\n            \"cmd\": \"clickEl\",\n            \"value\": {\n              totalTime: 300,\n              seleniumCallTime: 180,\n              executeAsyncTime: 120\n            }\n        }\n   */\n\n  const isEnabled = customizedOptions ? customizedOptions.isEnabled : ISENABLED;\n  const host = customizedOptions ? customizedOptions.host : HOST;\n  const port = customizedOptions ? customizedOptions.port : PORT;\n  const prefix = customizedOptions ? customizedOptions.prefix : PREFIX;\n  const jobName = customizedOptions ? customizedOptions.jobName : JOBNAME;\n\n  if (!isEnabled || !host || !port) {\n    return;\n  }\n\n  const fullEventKey = util.format(\n    \"%s%s.%s.%s.%s.%s\",\n    prefix,\n    event.capabilities.id || event.capabilities.browserName,\n    event.capabilities[\"tunnel-identifier\"] ? \"tunnel\" : \"notunnel\",\n    jobName,\n    event.type,\n    event.cmd\n  );\n\n  const client = sdclient ? sdclient : new SDC({ host, port, prefix });\n\n  client.timing(`${fullEventKey }.totalTime`, event.value.totalTime);\n  client.timing(`${fullEventKey }.seleniumCallTime`, event.value.seleniumCallTime);\n  client.timing(`${fullEventKey }.executeAsyncTime`, event.value.executeAsyncTime);\n}\n"]}